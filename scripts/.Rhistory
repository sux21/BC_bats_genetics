?taxo2phylog
?ade4::taxo2phylog
names(taxphy$leaves)
names(taxphy$nodes)
names(taxphy$parts)
names(taxphy$leaves)
names(taxphy$leaves) <- c(rep("T1",10), rep("T2",30), rep("T3",20))
ggtree(taxphy) + geom_tiplab() +
geom_nodelab(geom='label') + hexpand(0.05)
taxphy$leaves
taxphy
traits <- c(rep("T1",10), rep("T2",30), rep("T3",20))
taxphy <- taxo2phylog(as.taxo(df))
taxphy
ggtree(taxphy) + geom_tiplab(aes(label=traits)) +
geom_nodelab(geom='label') + hexpand(0.05)
traits
??ggtree
?geom_tiplab
ggtree(taxphy) + geom_tiplab(aes(label=traits, geom='text')) +
geom_nodelab(geom='label') + hexpand(0.05)
ggtree(taxphy) + geom_tiplab(aes(label=traits, geom='label')) +
geom_nodelab(geom='label') + hexpand(0.05)
traits
1:60
df <- data.frame(node2=c(rep("D",10), rep("E",10), rep("F",25), rep("G",5), rep("H",8), rep("I",2)),
node1=c(rep("A",20), rep("B",30), rep("C",10)),
tips=1:60)
df$node1 <- factor(df$node1)
df$node2 <- factor(df$node2)
taxphy <- taxo2phylog(as.taxo(df))
taxphy <- taxo2phylog(as.taxo(df))
taxphy <- ade4::taxo2phylog(as.taxo(df))
taxphy <- ade4::taxo2phylog(ade4::as.taxo(df))
df <- data.frame(node2=c(rep("D",10), rep("E",10), rep("F",25), rep("G",5), rep("H",8), rep("I",2)),
node1=c(rep("A",20), rep("B",30), rep("C",10)))
df$node1 <- factor(df$node1)
df$node2 <- factor(df$node2)
rownames(df) <- 1:60
taxphy <- ade4::taxo2phylog(ade4::as.taxo(df))
taxphy
df <- data.frame(node2=c(rep("D",10), rep("E",10), rep("F",25), rep("G",5), rep("H",8), rep("I",2)),
node1=c(rep("A",20), rep("B",30), rep("C",10)),
traits <- c(rep("T1",10), rep("T2",30), rep("T3",20)))
df <- data.frame(node2=c(rep("D",10), rep("E",10), rep("F",25), rep("G",5), rep("H",8), rep("I",2)),
node1=c(rep("A",20), rep("B",30), rep("C",10)),
traits=c(rep("T1",10), rep("T2",30), rep("T3",20)))
df$node1 <- factor(df$node1)
df$node2 <- factor(df$node2)
taxphy <- ade4::taxo2phylog(ade4::as.taxo(df[1:2,]))
taxphy <- ade4::taxo2phylog(ade4::as.taxo(df[,1:2]))
taxphy
ggtree(taxphy) %<+% df +
aes(color=traits) +
geom_tiplab() +
geom_nodelab(geom='label') + hexpand(0.05)
taxphy$tre
as.tibble(tree)
library(tidyverse)
as.tibble(tree)
as_tibble(tree)
tree <- taxphy$tre
as_tibble(tree)
taxphy
as_tibble(taxphy)
taxphy
library(ape)
ape::as.phylo(taxphy)
ggtree(taxphy) %<+% df +
aes(color=traits) +
geom_tiplab() +
geom_nodelab(geom='label') + hexpand(0.05)
full_join(taxphy, df[,c(1,2)], by="node1")
taxphy <- ape::as.phylo(taxphy)
full_join(taxphy, df[,c(1,2)], by="node1")
taxphy
full_join(taxphy, df[,c(1,3)], by="node1")
full_join(taxphy, df[,c(1,3)], by="node")
data(woodmouse)
d <- dist.dna(woodmouse)
d
tr <- nj(d)
tr
Nnode(tr)
Ntip(tr)
1:Nnode(tr) + Ntip(tr)
file <- system.file("extdata/BEAST", "beast_mcc.tree", package = "treeio")
beast <- ggtree::read.beast(file)
beast <- read.beast(file)
taxphy$tip.label
trait_df <- tibble(label = taxphy$tip.label, trait = df$traits)
full_join(taxphy, trait_df, by="label")
taxphy <- full_join(taxphy, trait_df, by="label")
ggtree(taxphy) %<+%
geom_tiplab() +
geom_nodelab(geom='label') + hexpand(0.05)
ggtree(taxphy) +
geom_tiplab() +
geom_nodelab(geom='label') + hexpand(0.05)
ggtree(taxphy) +
geom_nodelab(geom='label') + hexpand(0.05)
ggtree(taxphy) +
geom_tiplab() +
geom_nodelab(geom='label')
ggtree(taxphy) +
geom_tiplab() +
geom_nodelab(geom='label')
ggtree(taxphy) +
geom_tiplab() +
geom_nodelab(geom='label') +
geom_tippoint(mapping = aes(shape = trait, color = trait))
library(tidyverse)
library(readxl)
sample_list <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/BC_MYLU_MYYU_genetics_SampleList_XS_2025-11-21.csv")
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
Lillooet_Creston_WCS_data <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
View(sample_list)
View(South_coast_WCS_data)
### 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
#### 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
#### filter the South_coast_WCS_data to keep only the samples in the sample_list
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
# Lillooet and Creston samples
Lillooet_batid <- sample_list[!sample_list$batID %in% Vancouver_metadata$bat_id,]
# Lillooet and Creston samples
Lillooet_batid <- sample_list[!sample_list$batID %in% South_coast_metadata$bat_id,]
View(South_coast_metadata)
# Lillooet and Creston samples
Creston_Lillooet_batid <- sample_list[!sample_list$batID %in% South_coast_metadata$bat_id,]
View(Creston_Lillooet_batid)
Creston_Lillooet_batid$batID
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
View(correct_batID_df)
match(sample_list$batID, correct_batID_df$old)
View(sample_list)
sample_list$batID[match(sample_list$batID, correct_batID_df$old)]
?match
sample_list$batID[match(correct_batID_df$old %in% sample_list$batID)]
sample_list$batID[correct_batID_df$old %in% sample_list$batID]
correct_batID_df$old
correct_batID_df$old %in% sample_list$batID
sample_list$batID[sample_list$batID %in% correct_batID_df$old]
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new
# format batID of the South_coast_WCS_data to the same format as the batID in the sample list
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
#### filter the South_coast_WCS_data to keep only the samples in the sample_list
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
View(Lillooet_Creston_WCS_data)
#### filter the South_coast_WCS_data to keep only the samples in the sample_list
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
South_coast_WCS_data$bat_id %in% sample_list$batID
rm(list=ls())
sample_list <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/BC_MYLU_MYYU_genetics_SampleList_XS_2025-11-21.csv")
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
Lillooet_Creston_WCS_data <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
# format batID of the South_coast_WCS_data to the same format as the batID in the sample list
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
#### filter the South_coast_WCS_data to keep only the samples in the sample_list
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
# Lillooet and Creston samples
Lillooet_Creston_batid <- sample_list[!sample_list$batID %in% South_coast_metadata$bat_id,]
View(Lillooet_Creston_batid)
View(Lillooet_Creston_WCS_data)
View(Lillooet_Creston_batid)
897+148
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
str(South_coast_metadata)
str(South_coast_metadata$capture_time)
str(Lillooet_Creston_WCS_data$capture_time)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
str(South_coast_metadata$capture_time)
str(South_coast_WCS_data$capture_time)
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
str(South_coast_WCS_data$capture_time)
str(South_coast_WCS_data$capture_time)
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
str(South_coast_WCS_data$capture_time)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
# format and extract our sample data from the South_coast_WCS_data
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
South_coast_WCS_data$capture_date <- as.character(South_coast_WCS_data$capture_date)
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
Lillooet_Creston_WCS_data <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
South_coast_WCS_data$capture_date <- as.character(South_coast_WCS_data$capture_date)
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
# format and extract our sample data from the South_coast_WCS_data
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
Lillooet_Creston_WCS_data <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
South_coast_WCS_data$capture_date <- as.character(South_coast_WCS_data$capture_date)
South_coast_WCS_data$start_time <- as.character(South_coast_WCS_data$start_time)
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
# format and extract our sample data from the South_coast_WCS_data
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
Lillooet_Creston_WCS_data <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
South_coast_WCS_data$capture_date <- as.character(South_coast_WCS_data$capture_date)
South_coast_WCS_data$start_time <- as.character(South_coast_WCS_data$start_time)
South_coast_WCS_data$end_time <- as.character(South_coast_WCS_data$end_time)
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
# format and extract our sample data from the South_coast_WCS_data
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
South_coast_WCS_data$moon_phase
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
Lillooet_Creston_WCS_data <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
South_coast_WCS_data$capture_date <- as.character(South_coast_WCS_data$capture_date)
South_coast_WCS_data$start_time <- as.character(South_coast_WCS_data$start_time)
South_coast_WCS_data$end_time <- as.character(South_coast_WCS_data$end_time)
South_coast_WCS_data$moon_phase <- as.character(South_coast_WCS_data$moon_phase)
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
# format and extract our sample data from the South_coast_WCS_data
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
South_coast_WCS_data$mass_g
South_coast_WCS_data$mass_g <- as.numeric(South_coast_WCS_data$mass_g)
South_coast_WCS_data$mass_g
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
Lillooet_Creston_WCS_data <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
South_coast_WCS_data$capture_date <- as.character(South_coast_WCS_data$capture_date)
South_coast_WCS_data$start_time <- as.character(South_coast_WCS_data$start_time)
South_coast_WCS_data$end_time <- as.character(South_coast_WCS_data$end_time)
South_coast_WCS_data$moon_phase <- as.character(South_coast_WCS_data$moon_phase)
South_coast_WCS_data$mass_g <- as.numeric(South_coast_WCS_data$mass_g)
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
# format and extract our sample data from the South_coast_WCS_data
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
South_coast_WCS_data$forearm_length_mm
South_coast_WCS_data$forearm_length_mm <- as.numeric(South_coast_WCS_data$forearm_length_mm)
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
Lillooet_Creston_WCS_data$number_of_biopsies
South_coast_WCS_data$number_of_biopsies
South_coast_WCS_data$number_of_biopsies <- as.character(South_coast_WCS_data$number_of_biopsies)
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
metadata_BC_MYLU_MYYU_genetics <- dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
View(metadata_BC_MYLU_MYYU_genetics)
# some investigations on the metadata
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, area))
with(metadata_BC_MYLU_MYYU_genetics, table(field_species, capture_date))
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, capture_date))
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, capture_date))
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, capture_date))
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, metadata_BC_MYLU_MYYU_genetics$capture_month))
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, capture_month, ))
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, capture_month, capture_year))
# some investigations on the metadata
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, metadata_BC_MYLU_MYYU_genetics$site_name))
# some investigations on the metadata
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, metadata_BC_MYLU_MYYU_genetics$site_name))
library(tidyverse)
library(readxl)
Lillooet_Creston_WCS_data <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
Lillooet_Creston_WCS_data <- read.csv("E:/BC_bats_genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
View(Lillooet_Creston_WCS_data)
View(Lillooet_Creston_WCS_data)
South_coast_WCS_data <- readxl::read_xlsx("E:/BC_bats_genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
South_coast_WCS_data$capture_date <- as.character(South_coast_WCS_data$capture_date)
South_coast_WCS_data$start_time <- as.character(South_coast_WCS_data$start_time)
South_coast_WCS_data$end_time <- as.character(South_coast_WCS_data$end_time)
South_coast_WCS_data$moon_phase <- as.character(South_coast_WCS_data$moon_phase)
South_coast_WCS_data$mass_g <- as.numeric(South_coast_WCS_data$mass_g)
South_coast_WCS_data$forearm_length_mm <- as.numeric(South_coast_WCS_data$forearm_length_mm)
South_coast_WCS_data$number_of_biopsies <- as.character(South_coast_WCS_data$number_of_biopsies)
# variables which South coast metadata has but Lillooet/Creston metadata does not
colnames(South_coast_WCS_data)[!colnames(South_coast_WCS_data) %in% colnames(Lillooet_Creston_WCS_data)]
# variables which Lillooet/Creston metadata has but in South coast metadata does not
colnames(Lillooet_Creston_WCS_data)[!colnames(Lillooet_Creston_WCS_data) %in% colnames(South_coast_WCS_data)]
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
sample_list <- read.csv("E:/BC_bats_genetics/data/BC_MYLU_MYYU_genetics_SampleList_XS_2025-11-21.csv")
# format and extract our sample data from the South_coast_WCS_data
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
View(South_coast_metadata)
library(tidyverse)
library(readxl)
sample_list <- read.csv("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/BC_MYLU_MYYU_genetics_SampleList_XS_2025-11-21.csv")
South_coast_WCS_data <- readxl::read_xlsx("E:/Xingyuan_BC_MYLU_MYYU_Genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
sample_list <- read.csv("E:/BC_bats_genetics/data/BC_MYLU_MYYU_genetics_SampleList_XS_2025-11-21.csv")
South_coast_WCS_data <- readxl::read_xlsx("E:/BC_bats_genetics/data/WCS_data/2017-2025 capture data for reference nov 19 2025.xlsx",
sheet = "2017-2025 CLEAN Nov 13 2025")
Lillooet_Creston_WCS_data <- read.csv("E:/BC_bats_genetics/data/WCS_data/Lillooet_Creston_metadata.csv")
# format variable names
South_coast_WCS_data <- janitor::clean_names(South_coast_WCS_data)
Lillooet_Creston_WCS_data <- janitor::clean_names(Lillooet_Creston_WCS_data)
# format variable types
South_coast_WCS_data$capture_time <- as.character(South_coast_WCS_data$capture_time)
South_coast_WCS_data$capture_date <- as.character(South_coast_WCS_data$capture_date)
South_coast_WCS_data$start_time <- as.character(South_coast_WCS_data$start_time)
South_coast_WCS_data$end_time <- as.character(South_coast_WCS_data$end_time)
South_coast_WCS_data$moon_phase <- as.character(South_coast_WCS_data$moon_phase)
South_coast_WCS_data$mass_g <- as.numeric(South_coast_WCS_data$mass_g)
South_coast_WCS_data$forearm_length_mm <- as.numeric(South_coast_WCS_data$forearm_length_mm)
South_coast_WCS_data$number_of_biopsies <- as.character(South_coast_WCS_data$number_of_biopsies)
# variables which South coast metadata has but Lillooet/Creston metadata does not
colnames(South_coast_WCS_data)[!colnames(South_coast_WCS_data) %in% colnames(Lillooet_Creston_WCS_data)]
# variables which Lillooet/Creston metadata has but in South coast metadata does not
colnames(Lillooet_Creston_WCS_data)[!colnames(Lillooet_Creston_WCS_data) %in% colnames(South_coast_WCS_data)]
correct_batID_df <- data.frame(old = c("22AL0022", "22AL0371", "22AL0453", "22AL0909", "22BV00XX",
"22SL0130", "22SL0836", "22SL0843", "22SL0887"),
new = c("22AL0021", "22AL1059",  "22AL0003", "22AL0102", "22DEA19-069",
"22SL0369", "22SL0846", "22SL0850", "22SL0901"))
sample_list$batID[sample_list$batID %in% correct_batID_df$old] <- correct_batID_df$new #correct the wrong batIDs
# format and extract our sample data from the South_coast_WCS_data
## 1. append last two numbers of capture_year to bat_id
South_coast_WCS_data$bat_id <- with(South_coast_WCS_data, paste0(substr(capture_year, 3, 4), bat_id))
## 2. rename duplicated bat_id such that each bat_id is unique
South_coast_WCS_data$bat_id <- make.unique(South_coast_WCS_data$bat_id, sep = ".")
## 3. extract our sample data
South_coast_metadata <- South_coast_WCS_data[South_coast_WCS_data$bat_id %in% sample_list$batID,]
metadata_BC_MYLU_MYYU_genetics <- dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
# some investigations on the metadata
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, metadata_BC_MYLU_MYYU_genetics$site_name))
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, capture_month, capture_year))
# some investigations on the metadata
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, metadata_BC_MYLU_MYYU_genetics$site_name))
View(metadata_BC_MYLU_MYYU_genetics)
View(Lillooet_Creston_WCS_data)
View(South_coast_metadata)
# For Lillooet Creston data, use area name as site name
Lillooet_Creston_WCS_data$site_name <- Lillooet_Creston_WCS_data$area
metadata_BC_MYLU_MYYU_genetics <- dplyr::bind_rows(South_coast_metadata, Lillooet_Creston_WCS_data)
# some investigations on the metadata
with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, metadata_BC_MYLU_MYYU_genetics$site_name))
# some investigations on the metadata
sample_size <- with(metadata_BC_MYLU_MYYU_genetics, table(field_species_id, metadata_BC_MYLU_MYYU_genetics$site_name))
sample_size
# sum of all species by site
margin.table(sample_size, margin = 2)
# sum of sample sizes per species
margin.table(sample_size, margin = 1)
# total sample sizes
margin.table(sample_size)
pre_wns_samples <- read.csv("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/Pre_WNS_Data/Johnson_et_al_plos_2015data/bat_samples.csv")
View(pre_wns_samples)
library(readxl)
post_wns_samples <- readxl::read_xlsx("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/2024-Nova_Scotia_samples_for_JP_at_MacMaster.xlsx")
View(post_wns_samples)
post_wns_samples <- readxl::excel_sheets("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/2024-Nova_Scotia_samples_for_JP_at_MacMaster.xlsx")
post_wns_samples
post_wns_samples <- readxl::read_xlsx("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/2024-Nova_Scotia_samples_for_JP_at_MacMaster.xlsx",
sheet = "samples here")
warnings()
View(post_wns_samples)
post_wns_sample_size <- with(post_wns_samples, table(species, site))
post_wns_sample_size
pre_wns_samples <- ( read.csv("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/Pre_WNS_Data/Johnson_et_al_plos_2015data/bat_samples.csv")
|> subset(site == "Hayes cave" | site == "Glenelg")
)
pre_wns_samples <- ( read.csv("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/Pre_WNS_Data/Johnson_et_al_plos_2015data/bat_samples.csv")
#        |> subset(site == "Hayes cave" | site == "Glenelg")
)
?subset
pre_wns_samples <- ( read.csv("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/Pre_WNS_Data/Johnson_et_al_plos_2015data/bat_samples.csv")
|> subset(site == "Hayes Cave" | site == "Glenelg")
)
pre_wns_samples <- ( read.csv("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/Pre_WNS_Data/Johnson_et_al_plos_2015data/bat_samples.csv")
#  |> subset(site == "Hayes Cave" | site == "Glenelg")
)
table(pre_wns_samples$site)
pre_wns_samples <- ( read.csv("E://Xingyuan_NS_MYLU_Bottleneck/miscellaneous/Pre_WNS_Data/Johnson_et_al_plos_2015data/bat_samples.csv")
|> subset(site == "Hayes Cave" | site == "Glenelg Mine")
|> subset(species == "MYLU")
)
pre_wns_sample_size <- with(pre_wns_samples, table(species, site))
pre_wns_sample_size
88+253
post_wns_sample_size <- with(post_wns_samples, table(species, site))
post_wns_sample_size
View(post_wns_samples)
